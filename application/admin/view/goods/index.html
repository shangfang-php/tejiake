{include file='public/header' /}
<!-- ============================================================== -->
    <!-- Start right Content here -->
    <!-- ============================================================== -->
    <div class="content-page">
        <!-- Start content -->
        <div class="content">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card-box">
                            <!--<div class="dropdown pull-right">
                                    <a href="{:url('Menu/addMenu')}" class="card-drop">添加用户</a>
                            </div>-->
                            <h4 class="header-title m-t-0 m-b-30">商品管理</h4>
                            <p class="text-muted font-13 m-b-25">
                            </p>
                            <div class="" style="display: inline-block">
                                <a onclick="getType(0);" class="btn btn-primary waves-effect waves-light">全部</a>
                            </div>
                            <div class="" style="display: inline-block">
                                <a onclick="getType(1);" class="btn btn-primary waves-effect waves-light">爆款单</a>
                            </div>
                            <div class="" style="display: inline-block">
                                <a onclick="getType(2);"  class="btn btn-primary waves-effect waves-light">限时抢购</a>
                            </div>
                            <div class="" style="display: inline-block">
                                <a onclick="getType(3);"  class="btn btn-primary waves-effect waves-light">过夜单</a>
                            </div>
                            <div class="" style="display: inline-block">
                                <a onclick="getType(4);"  class="btn btn-primary waves-effect waves-light">直播单</a>
                            </div>
                            <div class="" style="display: inline-block">
                                <a onclick="getType(5);" class="btn btn-primary waves-effect waves-light">视频单</a>
                            </div>
                            <div class=" btn-group" >
                                <button onclick="getStatus(0);"  class="btn btn-default buttons-copy buttons-html5 btn-sm" tabindex="0" aria-controls="datatable-buttons">
                                    <span>全部</span>
                                </button>
                                <!--<button onclick="getStatus(1);"  class="btn btn-default buttons-copy buttons-html5 btn-sm" tabindex="0" aria-controls="datatable-buttons">
                                    <span>待审核</span>
                                </button>-->
                                <button onclick="getStatus(2);" class="btn btn-default buttons-csv buttons-html5 btn-sm" tabindex="0" aria-controls="datatable-buttons">
                                    <span>展示</span>
                                </button>
                                <button onclick="getStatus(3);" class="btn btn-default buttons-excel buttons-html5 btn-sm" tabindex="0" aria-controls="datatable-buttons">
                                    <span>过期</span>
                                </button>
                                <button onclick="getStatus(5);" class="btn btn-default buttons-excel buttons-html5 btn-sm" tabindex="0" aria-controls="datatable-buttons">
                                    <span>下架</span>
                                </button>
                            </div>
                            <!-- Right(Notification and Searchbox -->

                                <div class="hidden-xs" style="width:215px;right: 20px;position: absolute;top: 48px;" >
                                    <form role="search" class="app-search" action="#" method="get">
                                        <input  type="text" placeholder="输入商品名或用户手机" name="keyword" class="form-control">
                                        <a ><i class="fa fa-search"></i></a>
                                    </form>
                                    <input type="hidden" name="status" value="{$param.status}">
                                    <input type="hidden" name="type" value="{$param.type}">
                                </div>
                            <div class="table-responsive">
                                <table class="table m-0" >
                                    <thead>
                                    <tr>
                                        <th>
                                            <div class="checkbox checkbox-primary" >
                                                <input id="checkbox3" type="checkbox" onclick="getAll(this);">
                                                <label for="checkbox3">选择</label>
                                            </div>
                                        </th>
                                        <th>编号</th>
                                        <th>图片</th>
                                        <th>短标题</th>
                                        <th>分类</th>
                                        <th>价格</th>
                                        <th>优惠券</th>
                                        <th>佣金</th>
                                        <th>发布账号</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {volist name='data' id='vo' key="key"}
                                    <tr>
                                        <th>
                                            <div class="checkbox checkbox-primary">
                                                <input type="checkbox" name="gid[]" value="{$vo.id}">
                                                <label ></label>
                                            </div>
                                        </th>
                                        <th scope="row">{$key}</th>
                                        <td><img src="{$vo.main_img}" alt="" class="img-circle thumb-xl img-thumbnail m-b-10"></td>
                                        <td>{$vo.short_title}</td>
                                        <td>
                                            {if condition="$vo['type'] eq 1"}爆款单
                                                {elseif condition="$vo['type'] eq 2"}限时抢购
                                                {elseif condition="$vo['type'] eq 3"}过夜单
                                                {elseif condition="$vo['type'] eq 4"}直播单
                                                {elseif condition="$vo['type'] eq 5"}视频单
                                            {/if}
                                        </td>
                                        <td>
                                            <label>¥{$vo.real_money}</label>
                                            <label>¥{$vo.price}</label>
                                        </td>
                                        <td>
                                            <label>¥{$vo.coupon_money}</label>
                                            <label>剩余：{$vo.coupon_apply_num}/{$vo.coupon_total_num}</label>
                                            <label>到期：{$vo.coupon_end_time|date='Y-m-d H:i:s',###}</label>
                                        </td>
                                        <td>
                                            <label>¥{$vo.taoke_money}</label>
                                            <label>计划：{$vo.taoke_money_percent}%</label>
                                        </td>
                                        <td>{$vo.phone}</td>
                                        <td>
                                            {if condition="$vo['status'] eq 1"}待审核
                                                {elseif condition="$vo['status'] eq 2"}展示
                                                {elseif condition="$vo['status'] eq 3"}过期
                                            {/if}
                                        </td>
                                        <td>

                                            {if condition="$vo['is_delete'] eq 1"}
                                            <a class="label label-warning">已删除</a>
                                            {else/}
                                           <!-- <a href="{:url('Goods/edit',array('gid'=>$vo['id']))}"  class="label label-purple">修改</a>-->
                                            <a data-toggle="modal" href="{:url('Goods/edit',array('gid'=>$vo['id']))}" data-target="#custom-width-modal" class="label label-primary">修改</a>
                                            <a onclick="delGood({$vo['id']});"  class="label label-danger">删除</a>
                                            {/if}

                                        </td>
                                    </tr>
                                    {/volist}
                                    </tbody>
                                </table>
                                <div>
                                    <a onclick="delMuchGood();"  class="label label-primary">删除</a>
                                </div>

                                {$show}
                            </div>
                        </div>
                    </div><!-- end col -->
                </div>
                <!-- end row -->

            </div> <!-- container -->

        </div> <!-- content -->

    </div>
<!--获取用户详情-->
<div id="custom-width-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <div class="modal-body">
            </div>
        </div>
    </div>
</div>
<!-- /.modal end-->

    <!-- ============================================================== -->
    <!-- End Right content here -->
    <!-- ============================================================== -->

</div>
<!-- END wrapper -->
{include file='public/footer' /}
<script type="text/javascript">
    $("#custom-width-modal").on("hidden.bs.modal", function() {
        $(this).removeData("bs.modal");
    });
    //获取全部CheckBox
    function getAll(obj){
        var liobj = $('input[type=checkbox]');
        //alert(liobj.length);
        for (var i = 0; i < liobj.length; i++) {
            if ($(obj).is(':checked')) {
                $(liobj[i]).prop("checked", 'true');
            } else {
                $(liobj[i]).removeAttr("checked");
            }
        }
        //obj.is(:checked) = true;
    }


    function getStatus(param){
        var type = $('input[name=type]').val();
       // alert(type);
        window.location.href = "{:url('Goods/index')}?status="+param+"&type="+type;
        //alert("{:url('Goods/index')}?status="+param+"&type="+type);
    }
    function getType(param){
        var status = $('input[name=status]').val();
        window.location.href = "{:url('Goods/index')}?status="+status+"&type="+param;
    }

    //删除一个商品
    function delGood(param){
        if(confirm('当前操作不可恢复,确定要删除?')){
            //$.post("{:url('Goods/delGood')}",{gid:param}, function (dat) {
            $.post("{:url('Goods/changeStatus')}",{gid:param,type:1}, function (dat) {
                var data = JSON.parse(dat);
                alert(data.msg);
                if(data.status == 1){
                    window.location.href = window.location.href;
                }
                return false;
            });
        }
    }

    //删除多个商品
    function delMuchGood(){
        if(confirm('此操作不可恢复,求慎重')){
            var gids = $('input[type=checkbox]:checked');
            var gidsarr = new Array();
            var k=0;
            for (var i = 0; i < gids.length; i++) {
                if (!isNaN(gids[i].value)) {
                    gidsarr[k] = gids[i].value;
                    k++;
                }
            }
            //$.post("{:url('Goods/delGood')}",{gids:gidsarr}, function (dat) {
            $.post("{:url('Goods/changeStatus')}",{gids:gidsarr,type:1}, function (dat) {
                var data = JSON.parse(dat);
                alert(data.msg);
                if(data.status == 1){
                    window.location.href = window.location.href;
                }
                return false;
            });
        }

    }


</script>